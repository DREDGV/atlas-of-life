## Atlas_of_life_v0.6.8.8-inbox-map-stability (22.09.2025)

### ✅ Что добавлено/исправлено
- 🛡️ **Критические исправления стабильности карты при распределении Инбокса**
- 🔧 Улучшенная обработка ошибок с try-catch блоками вокруг всех операций распределения
- 🎯 Расширенные проверки безопасности для canvas и валидации состояния
- ⚡ Использование requestAnimationFrame для более безопасных обновлений UI
- 🔄 Механизмы fallback с логикой повтора при ошибках
- 📦 Улучшенное управление модальными окнами с задержками между операциями
- 🎨 Современный UI с градиентами, анимациями и улучшенной типографикой
- ⌨️ Полная навигация с клавиатуры (стрелки, Home/End, F1 для справки)
- 📋 Пакетные операции с чекбоксами для эффективной обработки множества элементов

### 🔧 Технические детали
- js/inbox.js: Enhanced error handling, requestAnimationFrame UI updates, modal conflict prevention
- js/inbox.js: Modern UI with gradients, animations, keyboard navigation, help system
- js/inbox.js: Batch operations with visual feedback, improved accessibility
- js/storage.js: Fixed tooltipDelay persistence in settings
- Enhanced safety checks for canvas, state validation, and UI updates
- Improved duplicate checking and state validation before distribution

### 🎯 Статус
- ✅ Работает - система Инбокса полностью функциональна
- ✅ Стабильно - карта больше не исчезает при распределении
- ✅ Современно - UI соответствует современным стандартам

## Atlas_of_life_v0.6.7.8-checklist-ux (20.09.2025)

### ✅ Что добавлено/исправлено
- Окно чек-листа по ПКМ: размер увеличен, поддержка ресайза и перемещения ЛКМ
- Защита от самопроизвольного закрытия при ресайзе/перетаскивании
- DnD сортировка пунктов в окне по ПКМ с визуальной подсветкой места вставки
- Проверка, чтобы всплывашки не мешали открытому редактору (ЛКМ)
- Редактор (ЛКМ): крупные чекбоксы, заметные поля ввода, фокус/hover, Enter подтверждает, Esc закрывает
- Редактор: прогресс в шапке, DnD-сортировка строк
- Карта: перетаскивание иконок чек-листов как у других объектов

### 🔧 Технические детали
- js/ui/checklist-window.js: drag/drop, resizable-safe, move window via header, drop indicators
- js/view_map.js: блокировка всплывашек при открытом редакторе, live-обновление координат чек-листа
- styles.css: стили окна, индикаторы вставки, улучшение полей ввода
- js/app.js: горячие клавиши, прогресс, Enter/ESC, глобальная защита всплывашек

### 🎯 Статус
- ✅ Работает

# Changelog

История версий (релизы) + дорожная карта (планы/идеи). 

## 📋 Правила версионирования
**Формат**: `Atlas_of_life_vX.Y.Z-ключевое_слово (ДД.ММ.ГГГГ)`
- **X.Y.Z** - семантическое версионирование (major.minor.patch)
- **ключевое_слово** - суть изменений (1-2 слова): `чистка`, `автодополнение`, `настройки`
- **дата** - когда была создана версия (для важных релизов)
- **Примеры**: `v0.2.10.1-чистка`, `v0.2.10-автодополнение`, `v0.2.9-настройки`

В UI версия берётся по первой секции `## Atlas_of_life_vX.Y.Z` сверху.

---

## Planned

- feat(inbox): Добавить концепт Инбокс — быстрый захват (N, Enter), список разборки (I), лёгкий парсер (#/@/!/~/p1..p4), статус `task.inbox` и распределение по проектам/доменам. Статус: планируется (MVP поэтапно).


## Atlas_of_life_v0.5.4-checklist-bugs-fixed (17.01.2025)

### ⚠️ КРИТИЧЕСКИЕ ПРОБЛЕМЫ С ЧЕК-ЛИСТАМИ
**СТАТУС: НЕ РАБОТАЕТ** - требует исправления

#### 🐛 Известные баги:
- **❌ Создание чек-листа невозможно** - кнопка не работает
- **❌ Карта пропадает** после нажатия "Создать чек-лист"
- **❌ Все объекты исчезают** с карты при попытке создания
- **❌ Редактор чек-листа** не открывается корректно

#### 🔧 Попытки исправления:
- ✅ Исправлен ID генератор для чек-листов (`c` + `generateId`)
- ✅ Добавлены предустановленные цвета (6 вариантов)
- ✅ Улучшен UX выбора цвета
- ✅ Исправлено отображение "undefined" в названии
- ✅ Добавлено принудительное обновление карты

#### 📋 План исправления на завтра:
1. **Диагностика** - проверить консоль браузера на ошибки
2. **Откат к рабочей версии** - если исправления не помогают
3. **Пошаговое тестирование** - создание чек-листа по шагам
4. **Альтернативный подход** - переписать логику создания с нуля

#### 🚨 Рекомендации:
- **НЕ ИСПОЛЬЗОВАТЬ** функцию создания чек-листов
- **СОХРАНИТЬ** текущее состояние для анализа
- **ПРОТЕСТИРОВАТЬ** другие функции приложения

---

## Atlas_of_life_v0.3.9-fixed-click (17.01.2025)

### 🎨 Улучшенный дизайн задач с 3D эффектами
- **✅ Улучшены градиенты задач** - более выраженные переходы от светлого к темному
- **✅ Добавлено внутреннее свечение** - белое пятно для 3D эффекта объемности
- **✅ Добавлена внешняя подсветка** - тонкое свечение вокруг задачи для глубины
- **✅ Улучшены контрастные границы** - автоматически подбираются под цвет задачи
- **✅ Добавлен эффект звездочки при клике** - 8 белых лучей, расходящихся от задачи
- **✅ Исправлена ошибка `ReferenceError: isClicked is not defined`** - переменная теперь определена корректно

### 🔧 Технические улучшения
- **Эффект клика перенесен в конец рендеринга** - теперь рисуется поверх всех остальных слоев
- **Добавлены отладочные логи** - для диагностики работы эффекта клика
- **Улучшена производительность** - оптимизирован порядок отрисовки слоев
- **Обновлена документация** - добавлены недоконченные улучшения в REQUESTS.md

### 📝 Статус эффекта звездочки
- **Частично работает** - код реализован, но требует доработки для корректного отображения
- **План доработки** - проверка логики `clickedNodeId` и `clickEffectTime`
- **Файл для работы** - `js/view_map.js:3252-3287`

---

## Atlas_of_life_v0.3.8-star-click (17.01.2025)

### 🎨 Эффект звездочки при клике на задачи
- **✅ Реализован эффект звездочки** - 8 белых лучей, расходящихся от задачи при клике
- **✅ Добавлено пульсирующее кольцо** - цветное кольцо вокруг задачи
- **✅ Добавлена яркая внутренняя обводка** - белое кольцо ближе к задаче
- **❌ Проблема с отображением** - эффект не виден из-за перекрытия слоев

---

## Atlas_of_life_v0.3.7-3d-tasks (17.01.2025)

### 🎨 3D эффекты для задач
- **✅ Улучшены градиенты** - более выраженные переходы для объемности
- **✅ Добавлено внутреннее свечение** - белое пятно для 3D эффекта
- **✅ Добавлена внешняя подсветка** - тонкое свечение для глубины
- **✅ Улучшены контрастные границы** - автоматический подбор цвета

---

## Atlas_of_life_v0.3.6-enhanced-tasks (17.01.2025)

### 🎨 Улучшенный внешний вид задач
- **✅ Добавлены радиальные градиенты** - от светлого к темному
- **✅ Добавлены контрастные границы** - автоматически подбираются под цвет
- **✅ Добавлены статус-эффекты** - пульсация для "doing", желтое кольцо для "today"
- **✅ Добавлен hover эффект** - белое кольцо при наведении
- **✅ Добавлена динамическая подсветка при клике** - с эффектом затухания

---

## Atlas_of_life_v0.3.5-circle-packing (17.01.2025)

### 🔄 Circle Packing алгоритм (отменен)
- **✅ Реализован Circle Packing** - естественное заполнение пространства задачами
- **❌ Отменен** - пользователь предпочел предыдущий кольцевой алгоритм
- **🔄 Возврат к v0.3.4** - восстановлен кольцевой алгоритм размещения

---

## Atlas_of_life_v0.3.4-no-overlap (17.01.2025)

### 🔧 Исправление наложения задач
- **✅ Ограничено количество задач в кольце** - максимум 8 задач на кольцо
- **✅ Динамическое расширение проектов** - размер увеличивается при большом количестве задач
- **✅ Устранено наложение** - задачи больше не накладываются друг на друга
- **✅ Улучшен алгоритм размещения** - более равномерное распределение

---

## Atlas_of_life_v0.3.3-adaptive-sizes (17.01.2025)

### 📏 Адаптивные размеры объектов
- **✅ Проекты растягиваются под задачи** - размер зависит от количества и размера задач
- **✅ Домены растягиваются под проекты** - размер зависит от количества и размера проектов
- **✅ Минимальные размеры** - базовые размеры для пустых объектов
- **✅ Умные формулы** - разные алгоритмы для малого и большого количества объектов

---

## Atlas_of_life_v0.3.2-visual-restore (17.01.2025)

### 🎨 Восстановление оригинального дизайна
- **✅ Восстановлен рендеринг доменов** - радиальный градиент и пунктирная граница
- **✅ Восстановлен рендеринг проектов** - простые круги с тонкой границей
- **✅ Восстановлен рендеринг задач** - правильные размеры и желтое кольцо для "today"
- **✅ Исправлены цвета** - объекты больше не меняют цвет при перемещении

---

## Atlas_of_life_v0.3.0-hierarchy-v2 (16.09.2025)

### 🏗️ Иерархия v2 - масштабная переработка архитектуры
- **✅ Создана система иерархии v2** - полная переработка связей между объектами
- **✅ Добавлены новые модули** - core.js, validation.js, locks.js, migration.js
- **✅ Реализована система блокировок** - предотвращение конфликтов при одновременном редактировании
- **✅ Добавлена валидация данных** - проверка корректности иерархических связей
- **✅ Создана система миграций** - плавный переход от старой к новой архитектуре
- **✅ Добавлены типы данных** - строгая типизация для иерархических объектов
- **✅ Улучшен инспектор** - расширенные возможности редактирования объектов
- **✅ Обновлены стили** - новые визуальные элементы для иерархии

### 🔧 Технические изменения
- **Новые файлы**: 24 файла добавлено, 9021 строка кода
- **Архитектура**: модульная система с четким разделением ответственности
- **Документация**: созданы HIERARCHY_V2_SPEC.md, ROADMAP_v0.3_Development.md
- **Тестирование**: добавлен hierarchy/test.js для проверки функциональности

### 📝 Статус иерархии v2
- **Частично отключена** - временно отключена в app.js для стабильности
- **Требует доработки** - есть проблемы с импортами и совместимостью
- **Готова к интеграции** - код написан, нужна финальная настройка

### 🎛️ Изменения в нижней панели
- **✅ Преобразование в информационную панель** - вместо создания задач теперь показывает подсказки
- **✅ Добавлены подсказки для навигации** - описание горячих клавиш и функций кнопок
- **✅ Улучшен UX** - пользователи получают контекстную помощь при наведении
- **✅ Сохранена функциональность QuickAdd** - быстрый ввод задач через текстовое поле

---

## Atlas_of_life_v0.3.1-critical-fixes (17.01.2025)

### 🐛 Критические исправления
- **✅ Исправлены дублирующие функции** - убраны дубликаты `rollbackHierarchyMigration` и `getHierarchyStatistics`
- **✅ Исправлена ошибка импортов** - `ReferenceError: isHierarchyV2Enabled is not defined`
- **✅ Устранены ошибки консоли** - приложение запускается без ошибок
- **✅ Оптимизированы логи** - убраны избыточные сообщения CALCULATING MOOD
- **✅ Исправлена ошибка тегов** - `Cannot read properties of undefined (reading join)`
- **✅ Добавлены CSS префиксы** - `-webkit-backdrop-filter` для Safari

---

## Atlas_of_life_v0.2.18.13-bug-fix (14.01.2025)

### 🐛 Критические исправления и улучшения
- **✅ Исправлено управление мышью** - левая кнопка перемещает объекты, правая редактирует
- **✅ Исправлено сохранение идей и заметок** - добавлены недостающие поля размера и прозрачности
- **✅ Улучшен дизайн объектов** - идеи (туманности) и заметки (астероиды) стали красивее и заметнее
- **✅ Добавлен дебаунсинг** - плавное изменение размера без рывков
- **✅ Исправлены функции перетаскивания** - идеи и заметки теперь можно перемещать
- **✅ Устранены ошибки консоли** - исправлено дублирование функций

### 🎨 Визуальные улучшения
- **Идеи (туманности)**: радиальный градиент, многослойный эффект, блики
- **Заметки (астероиды)**: объемный градиент, стабильная форма, тени для глубины
- **Слайдеры**: плавное изменение с дебаунсингом 100мс

### 🔧 Технические исправления
- Добавлены функции `handleIdeaDrop` и `handleNoteDrop`
- Исправлен экспорт `requestDraw` без дублирования
- Добавлены поля `ideaSize`, `ideaOpacity`, `noteSize`, `noteOpacity` в редакторы
- Улучшена обработка событий мыши для всех типов объектов

---

## Atlas_of_life_v0.2.18.2-cursor-fix (12.01.2025)

### 🎯 Исправление курсора в интерфейсе
- **✅ Убран курсор** - из всех заголовков и текстовых элементов
- **✅ Добавлен `user-select: none`** - для заголовков, статистики, фильтров
- **✅ Исправлен курсор** - рядом с иконкой календаря 📅
- **✅ Глобальная защита** - от курсора на всех иконках и эмодзи

### 💡 "Мягкие" уведомления и улучшения Today view
- **✅ "Мягкие" уведомления** - с кнопкой сброса фильтров при пустом списке
- **✅ Исправлен баг** - с выкидыванием из Today view при нажатии на фильтры
- **✅ Кнопка "Сбросить фильтры"** - появляется когда есть активные фильтры
- **✅ Умные сообщения** - разные тексты в зависимости от состояния фильтров
- **✅ Улучшена кнопка "Сегодня"** - принудительный вызов renderToday() при переключении
- **✅ Исправлен баг навигации** - кнопка "Сегодня" теперь всегда работает без перезагрузки
- **✅ Добавлен setTimeout()** - гарантирует корректное отображение Today view

### 🔧 Технические улучшения
- **✅ Отладочные логи** - для понимания работы фильтров и рендеринга
- **✅ Принудительный вызов renderToday()** - при переключении на Today view
- **✅ Улучшенная обработка ошибок** - проверки на существование элементов
- **✅ CSS оптимизация** - глобальные правила для иконок и эмодзи

**Ключевые улучшения:**
- Профессиональный интерфейс без нежелательного курсора
- Понятные уведомления с возможностью быстрого исправления
- Стабильная работа всех компонентов без багов
- Улучшенный UX с "мягкими" переходами

---

## Atlas_of_life_v0.2.16.2-chronos-concept (12.01.2025)

### ⏱️ Концепция «Машины времени» Atlas
- **✅ Создан CHRONOS_ENGINE_v0.3.md** — детальная концепция Past/Now/Future Engine
- **✅ Архитектура хронолога** — система событий, снапшотов и агрегатов
- **✅ Метрики и эвристики** — velocity, cycle-time, due-risk, burn-alert
- **✅ UI/UX концепция** — панель «Хронос» с вкладками Прошлое/Сейчас/Будущее
- **✅ Роудмап внедрения** — поэтапная реализация от v0.3.0 до v0.3.2
- **✅ Обновлен IDEAS.md** — добавлена ссылка на концепцию Хроноса

**Ключевые возможности концепции:**
- Сводки времени с графиками активности и теплокартами
- Прогнозы вероятности выполнения due-задач
- Напоминания-триггеры с контекстом
- Предупреждения о перегрузке и выгорании
- Энергетические потоки между доменами
- Time-travel снапшоты для просмотра прошлых состояний

---

## Atlas_of_life_v0.2.16.1-documentation-update (12.01.2025)

### 📋 Обновление документации
- **✅ Добавлен PRD_v0.3_Vision.md** — новый документ с видением продукта
- **✅ Структура "Прошлое → Настоящее → Будущее"** — эволюция концепции
- **✅ Roadmap v0.3.0** — конкретные планы развития с критериями успеха
- **✅ Обновлен IDEAS.md** — добавлены ссылки на связанные документы
- **✅ Создана папка docs/archive/** — для исторических документов

**Ключевые идеи из PRD v0.3:**
- Эмоциональная палитра доменов (mood-цвета)
- Режим фокуса "Чёрная дыра" (горячая клавиша B)
- Today 2.0 с drag-сортировкой и таймером
- Сезоны жизни (30-дневные циклы)
- Энергетические потоки и дневник отражений

---

## Atlas_of_life_v0.2.16.0-dnd-исправления (11.01.2025)

### 🎯 Полное исправление Drag&Drop системы
- **✅ Исправлены toast-уведомления** - теперь отображаются корректно в центре экрана
- **✅ Реализована система подтверждений** для всех операций перемещения:
  - Перемещение проектов между доменами
  - Извлечение проектов из доменов (независимые)
  - Перемещение задач между проектами  
  - Отвязка задач от проектов (независимые)
- **✅ Переработана архитектура DnD** по рекомендациям экспертов:
  - Pointer Events + Capture для стабильного перетаскивания
  - Конечная машина состояний (IDLE → PRESSED → DRAGGING → DROPPED)
  - Единая система координат worldToScreen/screenToWorld
  - Упрощенная логика drop без "магии"
- **✅ Исправлены CSS конфликты** - убраны !important из inline стилей, увеличен z-index
- **✅ Добавлено обновление инспектора** после подтверждения операций
- **✅ Устранены баги с повторным использованием** toast-уведомлений

### 🔧 Технические улучшения
- **Заменены mouse события на pointer события** для лучшей совместимости
- **Добавлен флаг isModalOpen** для блокировки событий canvas при показе toast
- **Исправлена функция hideToast()** - убрана бесконечная рекурсия
- **Улучшено позиционирование toast** - надежное центрирование
- **Добавлены fallback значения** для CSS переменных

### 🎨 UX улучшения
- **Визуальная обратная связь** - toast появляются в центре экрана
- **Четкие подтверждения** - понятные вопросы с кнопками действий
- **Стабильное перетаскивание** - не теряются события при быстрых движениях
- **Корректное обновление UI** - инспектор показывает актуальные данные

---

## Atlas_of_life_v0.2.14.8-чистый-интерфейс (09.01.2025)

### 🎨 Чистый интерфейс
- **Убраны лишние кнопки стилей** из верхней панели (8 кнопок: Оригинал, Современный, Неоновый+, Градиент, Голограмма, Смешанный, Техно, Минимал)
- **Удалена функция setupStyleSelector** из JavaScript
- **Стили остались доступны** в настройках (⚙️)
- **Интерфейс стал чище** - больше места для основных функций

### 🔧 Полное восстановление Edge
- **Восстановлена полная функциональность** в Microsoft Edge
- **Убраны все Edge-специфичные ограничения** - космические эффекты, звуки, анимации работают
- **Оставлены базовые защиты** - от двойной инициализации и рекурсии
- **Приложение работает полноценно** - все функции доступны

### 🐛 Исправления
- **Решена проблема с бесконечными циклами** в Edge (была в настройках DevTools)
- **Восстановлены космические анимации** и звуковые эффекты
- **Восстановлены эксперименты** и аналитика
- **Восстановлен автодополнение** и все hotkeys

---

## Atlas_of_life_v0.2.10.1-чистка (09.01.2025)

### 🧹 Очистка проекта
- **Удаление legacy кода**: убраны неиспользуемые функции `openDomainMenu_old()` и `domainActions_old()` (260+ строк)
- **Очистка backup файлов**: удалены `view_map.js.backup`, `view_map.fixed.js`, `tyles.css`
- **Удаление дубликатов**: убрана старая версия `addons/autocomplete.js`
- **Оптимизация размера**: проект уменьшен на ~15% (4,295 строк кода удалено)
- **Улучшение читаемости**: заменены TODO комментарии на "Future:" для ясности
- **Повышение стабильности**: убраны потенциальные источники конфликтов

## Atlas_of_life_v0.2.10-автодополнение (09.01.2025)

### Продвинутое автодополнение
- **Умная система подсказок**: автодополнение для тегов, проектов и доменов
- **Синтаксис**: `#тег`, `@проект`, `##домен` с интуитивными подсказками
- **Умное позиционирование**: popup автоматически выбирает лучшее место (сверху/снизу)
- **Навигация**: стрелки для выбора, Enter/Tab для вставки, Escape для отмены
- **Визуальные улучшения**: четкие контрастные стили, цветные индикаторы, blur эффект
- **Подсветка совпадений**: выделение найденного текста в предложениях
- **Метаданные**: показ количества связанных элементов для проектов и доменов

### Технические улучшения
- **Устранен конфликт**: отключена старая система автодополнения
- **Принудительные стили**: `!important` для гарантированного применения CSS
- **Отладочные функции**: `testAutocomplete()` и `forceRefreshStyles()` для тестирования
- **Документация**: создан `TAGS_GUIDE.md` с подробными инструкциями

---

## Atlas_of_life_v0.2.9 - 2025-01-09

### Система горячих клавиш
- **Полная система горячих клавиш**: 12 настраиваемых комбинаций для основных действий
- **Настраиваемые клавиши**: Возможность изменить любую комбинацию через интерфейс
- **Справка по клавишам**: Красивое отображение текущих горячих клавиш с элементами `<kbd>`
- **Горячие клавиши по умолчанию**:
  - `Ctrl+N` - создать новую задачу
  - `Ctrl+Shift+N` - создать новый проект
  - `Ctrl+Shift+D` - создать новый домен
  - `Ctrl+F` - открыть поиск
  - `1,2,3,4` - смена статуса задачи
  - `Escape` - закрыть инспектор
  - `Ctrl+0` - показать все объекты
  - `Ctrl+1` - подогнать активный домен
  - `Ctrl+2` - подогнать активный проект

### Централизованное меню настроек
- **Кнопка настроек ⚙️**: Единая точка доступа ко всем настройкам приложения
- **Выпадающее меню**: Красивое меню с 4 разделами настроек
- **Разделы настроек**:
  - ⌨️ Горячие клавиши - настройка и справка
  - 🎨 Тема - переключение между темной и светлой темой
  - 📱 Отображение - настройки связей, давности, свечения
  - 💾 Экспорт/Импорт - управление данными с кнопкой очистки

### Улучшения интерфейса
- **Чистый заголовок**: Убраны дублирующие элементы из верхней панели
- **Логичная группировка**: Все настройки организованы в одном месте
- **Улучшенная видимость задач**: Контрастные границы и тени для лучшей видимости на фоне звезд
- **Цвет "В работе"**: Изменен на синий для соответствия верхней панели

### Исправлено
- **Дублирующие экспорты**: Исправлены ошибки с дублирующими экспортами в модулях
- **Обратная совместимость**: Автоматическая инициализация настроек для старых версий
- **Обработка ошибок**: Добавлены try-catch блоки для стабильной работы

---

## Atlas_of_life_v0.2.8 - 2025-09-09

### Улучшения создания задач
- **Осмысленное размещение**: Новые задачи по умолчанию создаются вне доменов (независимые)
- **Выбор размещения**: Добавлена кнопка 🏠 для создания задач в активном домене
- **Умные подсказки**: Кнопка домена активна только при выбранном домене
- **Понятные уведомления**: Показывается где именно создана задача

### Улучшенный инспектор задач
- **Редактирование названия**: Можно изменить название задачи прямо в инспекторе
- **Кнопки статуса**: Визуальные кнопки для смены статуса с подсветкой активного
- **Приоритет**: Выпадающий список для выбора приоритета (1-4)
- **Время выполнения**: Поле для указания времени (30м, 1ч, 2ч 30м)
- **Теги**: Поле для добавления тегов через запятую
- **Кнопка "Сохранить"**: Применяет все изменения одной кнопкой

### Исправлено
- **Видимость задач**: Исправлена проблема с отображением созданных задач на карте
- **Логика размещения**: Убрана случайная привязка к первому домену в списке
- **Автовыбор домена**: Если нет активного домена, задачи создаются независимыми

---

## Atlas_of_life_v0.2.7.9 - 2025-09-09

### Улучшения быстрого ввода
- **Автодополнение тегов**: При вводе `#` показываются существующие теги с иконками
- **Автодополнение проектов**: При вводе `@` показываются существующие проекты
- **Автодополнение времени**: При вводе `!` показываются варианты времени (сегодня, завтра, дни недели)
- **Умная вставка**: Клик по предложению автоматически вставляет значение
- **Визуальные подсказки**: Иконки и описания для каждого типа автодополнения

### Исправлено
- **Поиск в панели**: Исправлена работа поиска с правильными вызовами функций
- **Очистка поиска**: Добавлена очистка `state.searchResults` при сбросе поиска
- **Безопасность**: Добавлены проверки для `window.layoutMap` и `window.drawMap`

---

## Atlas_of_life_v0.2.7.8 - 2025-09-09

### Исправлено
- **Критические ошибки**: Исправлены ошибки JavaScript, которые ломали работу приложения
- **Дублирование переменных**: Устранено дублирование переменной `stats` в коде
- **Неопределенные функции**: Добавлены проверки для `layoutMap` и `drawMap`
- **Безопасность поиска**: Добавлены проверки для `state.searchResults` перед обращением к свойствам
- **Стабильность**: Приложение теперь работает стабильно без зависаний

---

## Atlas_of_life_v0.2.7.7 - 2025-09-09

### Улучшения панели слева
- **Поиск**: Добавлен поиск по доменам, проектам и задачам с подсветкой результатов
- **Статистика**: Отображается количество задач по статусам в реальном времени
- **Фильтры по статусам**: Быстрые фильтры "Все", "План", "Сегодня", "В работе", "Готово"
- **Улучшенная информация**: Домены показывают количество проектов и задач
- **Подсветка поиска**: Найденные элементы подсвечиваются золотым цветом на карте
- **Клавиша Escape**: Очистка поиска по нажатию Escape

### Исправлено
- **Фильтрация**: Улучшена логика фильтрации задач по статусам и поиску
- **Производительность**: Оптимизирован рендеринг панели с большим количеством элементов

---

## Atlas_of_life_v0.2.7.6 - 2025-09-09

### Космические улучшения
- **Звёздное поле**: Добавлено анимированное звёздное поле с мерцающими звёздами
- **Планеты**: Заменены простые кружки на текстурированные планеты с градиентами
- **Туманности**: Домены теперь отображаются как цветные туманности с эффектами
- **Космические объекты**: Задачи стали звёздами/астероидами с разными формами по статусам
- **Параллакс**: Звёзды движутся с эффектом параллакса при навигации
- **Анимации**: Добавлены пульсирующие эффекты для задач "в работе"

### Исправлено
- **Фон карты**: Улучшен градиент фона для более глубокого космического вида
- **Производительность**: Оптимизирован рендеринг звёзд с проверкой видимости

---

## Atlas_of_life_v0.2.7.5 - 2025-09-09

### Улучшения интерфейса
- **Компактный header**: Уменьшены отступы и размеры кнопок для экономии места
- **Градиентный логотип**: Добавлен красивый градиент для названия приложения
- **Улучшенные статусы**: Статусы задач теперь с подсветкой и подсказками
- **Анимированное поле ввода**: Поле быстрого добавления с эффектами фокуса

### Исправлено
- **Версия приложения**: Исправлено отображение версии v0.2.7.5 в интерфейсе
- **Перенос текста**: Исправлен перенос текста в статусах (например, "в работе")
- **Кэширование**: Добавлены скрипты для принудительного обновления кэша

### Техническое
- Улучшена система обновления timestamp для обхода кэша браузера
- Оптимизированы CSS стили для более компактного отображения
- Исправлена логика отображения версии в модальном окне "О версии"

---

## Atlas_of_life_v0.2.7 - 2025-09-09

### Исправлено
- **DnD баги**: Независимые задачи теперь прикрепляются к домену при перетаскивании внутрь
- **Инспектор**: Исправлено отображение домена для всех задач
- **Привязка к проекту**: Добавлена корректная установка domainId при привязке задач к проектам
- **fitActiveProject()**: Полностью переписана сломанная функция подгонки вида к проекту
- **Обработка ошибок**: Улучшена обработка ошибок в операциях перетаскивания

### Техническое
- Консолидация логики confirmDetach() в единую реализацию
- Исправление CSS селекторов и классов toast
- Глобальное экспонирование функций для кросс-модульного доступа

---

## Atlas_of_life_v0.2.6 - 2025-09-06

### Добавлено
- Миграции хранилища (SCHEMA_VERSION + MIGRATIONS).
- Слой адаптеров хранилища (localStorageAdapter); заглушка IndexedDB.
- Локальный логгер аналитики (последние 100 событий в Local Storage).
- Inbox: автодополнение #/@.
- Today: бейдж срока и сортировка (срок → приоритет → updatedAt).
- Карта: двойной клик — fit проекта.

### Изменено
- Перерисовка карты сглажена (throttle); отсечение объектов вне области видимости.
- Тема через CSS‑переменные и переключатель (сохранение состояния).

### Исправлено
- Удалены «мертвые» ветви в раскладке карты.
- Убраны предупреждения о встроенных стилях (fileImport/viewToday/modal/toast/zoom slider).

## Atlas_of_life_v0.2.5 - 2025-09-04

Добавлено/изменено

- Новый алгоритм размещения задач внутри проектов: задачи группируются по кольцам, равномерно распределяются по окружности, что исключает пересечения.
- Динамический расчет радиусов проектов в зависимости от количества задач.
- Магнитное поведение при перетаскивании задачи внутрь проекта: задача примагничивается к краю круга.
- Возможность вытаскивать задачи из проекта с подтверждением пользователя.
- Исправлены синтаксические ошибки и дублирующиеся блоки кода, влияющие на отображение карты.

## Atlas_of_life_v0.2.4 - 2025-09-04 13:26

Добавлено/изменено

- Единая русская терминология в UI: легенда статусов в шапке — «план / сегодня / в работе / готово» (вместо backlog/today/doing/done).
- Переводы элементов в хедере: «Свечение» вместо Glow; «Подогнать домен/проект» вместо Fit.

## Atlas_of_life_v0.2.3 - 2025-09-04 13:20

Добавлено

- Сохранение пользовательских переключателей и вида: `Связи/Давность/Свечение` и активный `вид` (карта/сегодня) сохраняются в storage и восстанавливаются при запуске.
- Today/Inspector: отметка задач чекбоксом и «в Today» теперь сохраняются (добавлен saveState).

Изменено

- Удалены дубли CSS правил `.domenu`.
- Старые функции контекстного меню помечены как устаревшие (не используются), чтобы не мешать навигации в коде.

## Atlas_of_life_v0.2.2 - 2025-09-04 03:03

Добавлено

- Скрипт авто‑бампа версии: `tools/bump-version.ps1` — обновляет `CHANGELOG.md` и `js/app.js`.

Изменено

- Заголовок релиза содержит дату и время: `YYYY-MM-DD HH:mm`.
- Скрипт теперь вставляет НОВУЮ секцию релиза вверху, сохраняя историю (не перезаписывает предыдущую).

Добавлено

- CRUD доменов: создать, переименовать, изменить цвет (палитра), слить с…, удалить (перенос проектов / удаление вместе с задачами). Контекстное меню (⋯ / ПКМ).
- Fit/Focus: кнопки и хоткеи; двойной клик по домену — фокус.
- Кнопка «О версии»: модалка с номером версии и ссылкой на CHANGELOG; авто‑подхват версии из CHANGELOG.

Изменено

- Карта: зум к курсору, константная скорость панорамирования, единая матрица трансформации.
- Фильтры: домен/тег влияют на видимые узлы и рёбра.
- Размещение задач: «золотой угол», меньше наложений.
- Связи: адаптивная кривизна Безье (длинные — прямее).

Производительность

- Динамический cap рёбер + Glow с гистерезисом, FPS‑оверлей (Ctrl+Shift+F).

I18N/UX

- Очищены русские строки; улучшена читаемость ссылок в модалках.

Быстрый ввод

- RU‑парсер для #/@/~ p1..p4 и !сегодня/завтра/через N мин/ч, дни недели.

## Atlas_of_life_v0.2.1 - 2025-09-04 02:41

- Полировка доменов и навигации карты: мягкие подсказки при создании/переименовании, мгновенный пересчёт счётчиков, плавный Fit/Focus с ограничением масштаба, палитра цвета с немедленным применением, безопасное удаление/слияние доменов и тосты со сводкой переносов/удалений.

## Atlas_of_life_v0.1.0 — 2025‑08‑XX

Первый релиз (MVP)

- Карта, экран «Сегодня», экспорт/импорт JSON, демо‑данные.

## [Unreleased]

- refactor(view): make camera the single source of truth; normalize wheel; DPR-safe resize; invariants check (Step C polish) (ee653c9)
- refactor(view): introduce camera module and route pan/zoom + worldscreen via camera (Step C) (287bb50)
- fix(view): implement missing drawArrow/strokeLine/fillCircle, robust roundedRectPath (r clamped) (ef56d4a)
- fix(view): resolve duplicate identifier by removing second clamp import (keep state.js clamp) (d893c2c)
- refactor(view): wire consolidated imports for draw/text utils (no behavior change) (1d219a4)
- refactor(view): extract pure draw/text helpers to view_map/render and import from view_map.js (no behavior change) (3cf66b6)
- refactor(view): start step B by extracting dist2 to render utils and wiring import (no behavioral changes) (92aeb3e)
- ci(audit): run import/export audit on push/PR; build: add eslint (no-default-export); feat(app): wire safe map v2 gate (disabled by default) (7d9c3b6)
- feat(flags): add modularMap feature flag; docs/ts-check typedefs in scaffold; enforce single-entry and cleanup (3ddad69)
- chore(repo): clean backups, enforce single entry, add audit script and docs (4028f70)
- chore(docs): add modular map playbook and non-breaking scaffold (554a7ef)
- docs: add comprehensive study guide for other AI to understand the project (08e0325)
- docs: update changelog after rollback to working version (ccf221a)
- docs: add rollback success documentation and working version tag (9b80a92)
- fix: update app version and improve WORKFLOW with automatic date handling (2023528)
- docs: update dates to September 22, 2025 in all documentation files (2b57d03)
- feat(workflow): complete inbox system implementation with full documentation (493f0f6)
- fix: export requestLayout function to resolve map display issue (9c4e58e)
- fix: disable cosmic animations to eliminate visual freezes (26fee7a)
- fix(inbox): resolve map disappearing issues during distribution (074cb3b)
- feat(inbox): complete UI polish with modern design and enhanced UX (50f81ad)
- fix: restore smooth object dragging and fix recursive requestDrawThrottled call (170ca85)
- fix: restore smooth map panning and zooming by reverting to requestDraw (32dca25)
- fix: prevent infinite draw loops during task movement with throttled requests (7d937aa)
- fix: disable avoidOverlap and cleanupDuplicateObjects to diagnose freezes (1e267f8)
- fix: add safety checks to prevent map disappearance (509a78e)
- fix: aggressive duplicate cleanup and improved positioning algorithm (74f4f6f)
- feat(inbox): implement batch operations and advanced hotkeys (d1e6138)
- fix: resolve map visual bugs - duplicate objects, positioning, artifacts (163ca75)
- fix(settings): resolve tooltip delay not persisting after page refresh (692971b)
- fix(inbox): resolve map disappearing issues with better initialization checks (3114f0a)
- fix: improve tooltip delay settings with custom input and better validation (06aee69)
- feat: implement two-level tooltip system with configurable delay (dbc5238)
- docs: add rich object tooltips feature to ideas and requests (3f9593a)
- fix: add object hover handling to pointer events (1bc2bd6)
- fix(inbox): resolve critical bugs with map freezing and data persistence (acce777)
- fix: show map object tooltips in info panel (641852a)
- feat(inbox): implement full distributor with quick actions and multiline support (3420c18)
- feat: add comprehensive tooltips for all UI elements (b402261)
- feat(inbox): make Inbox visible and accessible by default (4972ae3)
- fix: temporarily disable old nav hints to test new tooltips (d68c3fe)
- fix: force cache refresh for info panel updates (88e039c)
- feat: enhance info panel with tooltips for new objects (e90ca6e)
- fix(inbox): correct import path for saveState from storage.js (266cf0b)
- fix(inbox): resolve showToast dependency and initialization issues (af5dd83)
- feat(inbox): implement MVP Inbox system with quick capture and distribution (ac541d9)
- feat: add debugging for checklist duplication and hotkeys (8becbb1)
- fix: исправлено дублирование строк в чек-листах (dc79e21)
- feat: добавлены быстрые действия и поиск для чек-листов (36f3de6)
- docs(inbox): add Inbox concept to ideas; add request entry; planned note in changelog (b7375e2)
- docs: обновлен CHANGELOG и IDEAS после оптимизации производительности (984945c)
- perf: масштабная оптимизация производительности Canvas и рендеринга (c9fea47)
- fix: исправлены критические проблемы с Toast-уведомлениями (5a0db92)
- perf(zoom+drag): skip heavy hit-tests right after zoom; debounce pointer redraw; reduce glow/pulse and FPS a bit (eb2a0b3)
- perf(dnd): reduce animations and logs; stabilize pointer move detection; lighter glow/line widths; fewer trig calls (c93b790)
- fix(dnd): live drop-target detection on pointermove; update lastMouseClient; enable project highlight and task attach between projects (3b21a7c)
- fix(dnd): highlight drop targets, tolerant project hit for tasks, correct move-confirm prompt; improve drag visuals (f616a67)
- fix(hierarchy-ui): correct task move vs detach prompts; widen project hit area for task DnD; keep domain/project info accurate during moves (638817e)
- feat(hierarchy): keep parentId/children in sync for projectdomain, taskproject, idea/notedomain moves (7341427)
- fix(hierarchy): sync parentId/children on moves; add safe helpers (17666c2)
- fix(checklist-icon): stable preview via rect-based culling and hit-test; taller card and spacing; always up to 3 lines (64e2068)
- fix(checklist-icon): ensure preview lines render  taller card, larger spacing, preview also on hover in hybrid mode (1a99399)
- feat(checklist-icon): wider aspect ratio (3.8x vs 2.1x) to fit more text; adjust top stripe height (2efbdb9)
- fix(checklist-icon): progress badge no longer overlaps text; add zoom hysteresis for stable preview; draw badge above card (54d6deb)
- feat(checklist-icon): hybrid mode  title+progress badge always; preview appears on hover or zoom; settings option added (902ae8a)
- fix(checklist-icon): smarter text fitting  dynamic font size and ellipsis; preview 2/3 shows readable first line (4c0e704)
- fix(checklist-icon): cleaner modes  title centered for title/minimal; preview modes show only 23 bullets without progress bar (2368b22)
- fix(settings): persist showDndHints and checklistIconMode in storage load/save (8aa91fa)
- feat(checklist-icon): add display modes (title|minimal|preview2|preview3) and settings toggle; clean text layout to avoid overlaps (b55a01f)
- fix(checklist-icon): prevent text clutter; center title; show progress and counts; clip to card (402ec4c)
- feat(checklist-icon): card layout with padding + clip; safe text truncation; internal progress bar; avoid overflow (9a8f53e)
- fix(checklist-pkm): close button works reliably  ignore drag when clicking (ac10937)
- chore(ci): make post-commit hook robust (fallback to powershell.exe, skip if missing) (c8fbe33)
См. [IDEAS.md](./IDEAS.md) для планов и идей.

### Added
- Storage migrations and adapter layer.
- Light/dark theme via CSS variables and toggle.
- Local analytics (ring buffer in localStorage).
- Map: dbl-click project to fit bbox.
- Map: viewport culling of tasks/links.
- Inbox autocomplete (#/@), Today sorting + due badge, .ics export.

### Changed
- Throttled redraws on wheel/drag.
- Minor CSS variable refinements.

### Fixed
- Removed dead branches in map code.
- Reduced potential lag spikes on interactions.

## v0.2.12.7-космос-фикс-домена (09.01.2025)

### Added
- **Космические эффекты удаления доменов** - множественные взрывы по периметру и центральный взрыв
- **Функция animateDomainPulse** - отсутствующая функция для анимации удаления доменов
- **Валидация параметров** - проверки isFinite() для всех координат и размеров частиц

### Fixed
- **Ошибка animateDomainPulse is not a function** - добавлена отсутствующая функция
- **Ошибки createRadialGradient** - исправлены нефинитные значения в космических эффектах
- **Структура классов** - исправлено наследование CosmicAnimations от ParticleSystem
- **Рекурсивные вызовы** - убраны бесконечные циклы в функциях update/render/clear

### Improved
- **Космические эффекты** - улучшена стабильность и производительность
- **Удаление объектов** - все типы объектов (задачи, проекты, домены) удаляются с эффектами
- **Звуковые эффекты** - добавлены звуки при удалении доменов

### Known Issues
- После удаления домена показывается один из оставшихся доменов вместо всего проекта
- Звуковые эффекты требуют улучшения для лучшей слышимости
